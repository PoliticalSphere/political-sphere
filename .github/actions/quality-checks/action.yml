name: "Quality Checks"
description: "Run linting, type checking, and code quality checks"
author: "Political Sphere"

inputs:
  run-lint:
    description: "Run linting checks"
    required: false
    default: "true"

  run-typecheck:
    description: "Run TypeScript type checking"
    required: false
    default: "true"

  run-format-check:
    description: "Check code formatting"
    required: false
    default: "true"

  lint-command:
    description: "Command to run linting"
    required: false
    default: "npm run lint"

  typecheck-command:
    description: "Command to run type checking"
    required: false
    default: "npm run type-check"

  format-check-command:
    description: "Command to check formatting"
    required: false
    default: "npm run format:check"

outputs:
  lint-passed:
    description: "Whether linting passed"
    value: ${{ steps.results.outputs.lint-passed }}

  typecheck-passed:
    description: "Whether type checking passed"
    value: ${{ steps.results.outputs.typecheck-passed }}

  format-passed:
    description: "Whether format checking passed"
    value: ${{ steps.results.outputs.format-passed }}

runs:
  using: "composite"
  steps:
    - name: Run Linting
      id: lint
      if: inputs.run-lint == 'true'
      shell: bash
      env:
        LINT_COMMAND: ${{ inputs.lint-command }}
      run: |
        echo "ðŸ” Running linting checks..."
        if "$LINT_COMMAND"; then
          echo "âœ… Linting passed"
          echo "lint-result=passed" >> "$GITHUB_OUTPUT"
        else
          echo "âŒ Linting failed"
          echo "lint-result=failed" >> "$GITHUB_OUTPUT"
          exit 1
        fi
      continue-on-error: false

    - name: Run Type Checking
      id: typecheck
      if: inputs.run-typecheck == 'true'
      shell: bash
      env:
        TYPECHECK_COMMAND: ${{ inputs.typecheck-command }}
      run: |
        echo "ðŸ” Running TypeScript type checking..."
        if "$TYPECHECK_COMMAND"; then
          echo "âœ… Type checking passed"
          echo "typecheck-result=passed" >> "$GITHUB_OUTPUT"
        else
          echo "âŒ Type checking failed"
          echo "typecheck-result=failed" >> "$GITHUB_OUTPUT"
          exit 1
        fi
      continue-on-error: false

    - name: Run Format Checking
      id: format
      if: inputs.run-format-check == 'true'
      shell: bash
      env:
        FORMAT_CHECK_COMMAND: ${{ inputs.format-check-command }}
      run: |
        echo "ðŸ” Checking code formatting..."
        if "$FORMAT_CHECK_COMMAND"; then
          echo "âœ… Format checking passed"
          echo "format-result=passed" >> "$GITHUB_OUTPUT"
        else
          echo "âŒ Format checking failed"
          echo "format-result=failed" >> "$GITHUB_OUTPUT"
          exit 1
        fi
      continue-on-error: false

    - name: Summarize Results
      id: results
      shell: bash
      run: |
        LINT_RESULT="${{ steps.lint.outputs.lint-result || 'skipped' }}"
        TYPECHECK_RESULT="${{ steps.typecheck.outputs.typecheck-result || 'skipped' }}"
        FORMAT_RESULT="${{ steps.format.outputs.format-result || 'skipped' }}"

        echo "lint-passed=$LINT_RESULT" >> "$GITHUB_OUTPUT"
        echo "typecheck-passed=$TYPECHECK_RESULT" >> "$GITHUB_OUTPUT"
        echo "format-passed=$FORMAT_RESULT" >> "$GITHUB_OUTPUT"

        echo "## Quality Checks Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Check | Result |" >> $GITHUB_STEP_SUMMARY
        echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| Linting | $LINT_RESULT |" >> $GITHUB_STEP_SUMMARY
        echo "| Type Checking | $TYPECHECK_RESULT |" >> $GITHUB_STEP_SUMMARY
        echo "| Format Checking | $FORMAT_RESULT |" >> $GITHUB_STEP_SUMMARY
